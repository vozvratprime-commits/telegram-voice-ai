<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AI –ü–æ–∏—Å–∫ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white min-h-screen flex flex-col items-center p-4">

    <h1 class="text-3xl font-bold font-sans text-yellow-400 mb-6">üåé –ü–æ–∏—Å–∫ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–µ (–ì–æ–ª–æ—Å–æ–º)</h1>
    <p class="text-gray-400 mb-8 text-sm">–°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ **–∫–∞–∂–¥—ã–π** –≤–∞—à –∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å.</p>

    <button id="start-btn" onclick="startListening()" 
        class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg transition transform active:scale-95">
        üéôÔ∏è –í–ö–õ–Æ–ß–ò–¢–¨ –ú–ò–ö–†–û–§–û–ù
    </button>

    <div id="status" class="mt-8 text-gray-500">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –∏ —Ä–∞–∑—Ä–µ—à–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω</div>
    
    <div class="mt-4 text-center">
        <p class="text-xs text-gray-600 uppercase">–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å:</p>
        <p id="last-question" class="text-xl font-bold text-yellow-300">...</p>
    </div>

    <script>
        // *** –ê–î–†–ï–° –í–ê–®–ï–ì–û –¢–ï–ö–£–©–ï–ì–û –°–ï–†–í–ò–°–ê RENDER ***
        // –Ø –æ–±–Ω–æ–≤–∏–ª –∞–¥—Ä–µ—Å –Ω–∞ –≤–∞—à —Ç–µ–∫—É—â–∏–π: telegram-voice-ai-vw25.onrender.com
        const SERVER_URL = 'https://telegram-voice-ai-vw25.onrender.com/ask_ai'; 
        // ****************************************
        
        let recognition;

        function startListening() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("–ù—É–∂–µ–Ω –±—Ä–∞—É–∑–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π SpeechRecognition API (–Ω–∞–ø—Ä–∏–º–µ—Ä, Google Chrome –∏–ª–∏ –Ø–Ω–¥–µ–∫—Å.–ë—Ä–∞—É–∑–µ—Ä)!");
                return;
            }

            recognition = new SpeechRecognition();
            recognition.lang = 'ru-RU'; 
            recognition.continuous = true; 
            recognition.interimResults = false;

            document.getElementById('start-btn').classList.add('bg-red-600', 'animate-pulse');
            document.getElementById('start-btn').innerText = "üëÇ –°–õ–£–®–ê–Æ...";
            document.getElementById('status').innerText = "–ì–æ–≤–æ—Ä–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞...";

            recognition.onresult = (event) => {
                const last = event.results.length - 1;
                const text = event.results[last][0].transcript.trim();
                
                if (event.results[last].isFinal) {
                    
                    if (text.length > 0) {
                        document.getElementById('last-question').innerText = text;
                        sendToServer(text);
                    }
                }
            };
            
            recognition.onend = () => recognition.start(); 
            
            try {
                recognition.start();
            } catch (e) {
                document.getElementById('status').innerText = "‚ùå –û—à–∏–±–∫–∞: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞!";
                console.error("Recognition Start Error:", e);
            }
        }

        async function sendToServer(question) {
            document.getElementById('status').innerText = "‚è≥ –ò—â—É –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ...";
            
            try {
                const response = await fetch(SERVER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: question })
                });

                if (response.ok) {
                    document.getElementById('status').innerText = "‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram!";
                } else {
                    document.getElementById('status').innerText = "‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞/API! (–ö–æ–¥: " + response.status + ")";
                }
            } catch (e) {
                document.getElementById('status').innerText = "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –∞–¥—Ä–µ—Å!)";
                console.error("Network Error:", e);
            }
            
            setTimeout(() => {
                document.getElementById('status').innerText = "üëÇ –°–õ–£–®–ê–Æ...";
            }, 2000);
        }
    </script>
</body>
</html>