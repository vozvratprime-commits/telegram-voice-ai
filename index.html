<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AI –ü–æ–∏—Å–∫ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white min-h-screen flex flex-col items-center p-4">

    <h1 class="text-3xl font-bold font-sans text-yellow-400 mb-6">üåé –ü–æ–∏—Å–∫ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–µ (–ì–æ–ª–æ—Å–æ–º)</h1>
    <p class="text-gray-400 mb-8 text-sm">–°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ **–∫–∞–∂–¥—ã–π** –≤–∞—à –∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å.</p>

    <button id="start-btn" onclick="startListening()" 
        class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg transition transform active:scale-95">
        üéôÔ∏è –í–ö–õ–Æ–ß–ò–¢–¨ –ú–ò–ö–†–û–§–û–ù
    </button>

    <div id="status" class="mt-8 text-gray-500">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –∏ —Ä–∞–∑—Ä–µ—à–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω</div>
    
    <div class="mt-4 text-center">
        <p class="text-xs text-gray-600 uppercase">–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å:</p>
        <p id="last-question" class="text-xl font-bold text-yellow-300">...</p>
    </div>

    <script>
        // *** –í–ê–®–ê –ü–û–°–¢–û–Ø–ù–ù–ê–Ø –°–°–´–õ–ö–ê –° RENDER ***
        // –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º /ask_ai, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã POST –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
        const SERVER_URL = 'https://telegram-voice-ai.onrender.com/ask_ai'; 
        // ****************************************
        
        let recognition;

        function startListening() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É API —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Chrome/–Ø–Ω–¥–µ–∫—Å)
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("–ù—É–∂–µ–Ω –±—Ä–∞—É–∑–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π SpeechRecognition API (–Ω–∞–ø—Ä–∏–º–µ—Ä, Google Chrome –∏–ª–∏ –Ø–Ω–¥–µ–∫—Å.–ë—Ä–∞—É–∑–µ—Ä)!");
                return;
            }

            recognition = new SpeechRecognition();
            recognition.lang = 'ru-RU'; // –†—É—Å—Å–∫–∏–π —è–∑—ã–∫
            recognition.continuous = true; // –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ —Å–ª—É—à–∞–Ω–∏–µ (—Ö–æ—Ç—è –º—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
            recognition.interimResults = false;

            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            document.getElementById('start-btn').classList.add('bg-red-600', 'animate-pulse');
            document.getElementById('start-btn').innerText = "üëÇ –°–õ–£–®–ê–Æ...";
            document.getElementById('status').innerText = "–ì–æ–≤–æ—Ä–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞...";

            recognition.onresult = (event) => {
                const last = event.results.length - 1;
                const text = event.results[last][0].transcript.trim();
                
                if (event.results[last].isFinal) {
                    
                    if (text.length > 0) {
                        document.getElementById('last-question').innerText = text;
                        sendToServer(text);
                    }
                }
            };
            
            // –ï—Å–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –º—ã –∑–∞–ø—É—Å–∫–∞–µ–º –µ–≥–æ —Å–Ω–æ–≤–∞ (–¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã)
            recognition.onend = () => recognition.start(); 
            
            try {
                recognition.start();
            } catch (e) {
                // –ï—Å–ª–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–ª–∏ –Ω–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
                document.getElementById('status').innerText = "‚ùå –û—à–∏–±–∫–∞: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞!";
                console.error("Recognition Start Error:", e);
            }
        }

        async function sendToServer(question) {
            document.getElementById('status').innerText = "‚è≥ –ò—â—É –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ...";
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¢–û–õ–¨–ö–û –≤–æ–ø—Ä–æ—Å –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä Render
                const response = await fetch(SERVER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: question })
                });

                if (response.ok) {
                    document.getElementById('status').innerText = "‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram!";
                } else {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ Gemini –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç)
                    document.getElementById('status').innerText = "‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞/API! (–ö–æ–¥: " + response.status + ")";
                }
            } catch (e) {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ (—Å–µ—Ä–≤–µ—Ä Render –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
                document.getElementById('status').innerText = "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –∞–¥—Ä–µ—Å!)";
                console.error("Network Error:", e);
            }
            
            // –°–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                document.getElementById('status').innerText = "üëÇ –°–õ–£–®–ê–Æ...";
            }, 2000);
        }
    </script>
</body>
</html>